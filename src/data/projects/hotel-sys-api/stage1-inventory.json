{
  "project_name": "hotel-sys-api",
  "is_multi_project": false,
  "total_flows": 6,
  "total_subflows": 3,
  "connector_types": [
    "http:listener-config",
    "apikit:config",
    "db:config"
  ],
  "api_layers": {
    "system": [
      "hotel-api-main",
      "hotel-api-console",
      "get:\\hotels\\search:hotel-api-config",
      "get:\\hotels\\(id):hotel-api-config",
      "post:\\hotels\\(id)\\book:hotel-api-config",
      "get:\\health:hotel-api-config"
    ]
  },
  "flows": [
    {
      "name": "hotel-api-main",
      "type": "flow",
      "trigger": "http-listener",
      "http_method": "",
      "http_path": "/api/*",
      "api_layer": "system",
      "step_count": 15,
      "source_project": "hotel-sys-api",
      "source_layer": "system",
      "connectors": [],
      "subflow_refs": [],
      "called_by": [],
      "call_count": 0,
      "sql_queries": [],
      "http_urls": [],
      "dataweave_complexity": "simple",
      "is_boilerplate": true,
      "error_handlers": [
        {
          "type": "on-error-propagate",
          "error_type": "APIKIT:BAD_REQUEST",
          "status_code": ""
        },
        {
          "type": "on-error-propagate",
          "error_type": "APIKIT:NOT_FOUND",
          "status_code": ""
        },
        {
          "type": "on-error-propagate",
          "error_type": "APIKIT:METHOD_NOT_ALLOWED",
          "status_code": ""
        }
      ],
      "dataweave_transforms": [
        {
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Bad request\"}",
          "output_fields": [
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Bad request\"}\n%dw 2.0\noutput application/json\n---\n{message: \"Bad request\"}",
          "output_fields": [
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Bad request\"}",
          "output_fields": [
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Resource not found\"}",
          "output_fields": [
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Resource not found\"}\n%dw 2.0\noutput application/json\n---\n{message: \"Resource not found\"}",
          "output_fields": [
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Resource not found\"}",
          "output_fields": [
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Method not allowed\"}",
          "output_fields": [
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Method not allowed\"}\n%dw 2.0\noutput application/json\n---\n{message: \"Method not allowed\"}",
          "output_fields": [
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Method not allowed\"}",
          "output_fields": [
            "message"
          ]
        }
      ],
      "set_variables": {},
      "processors": [
        {
          "type": "http:listener",
          "name": "",
          "content": ""
        },
        {
          "type": "apikit:router",
          "name": "",
          "content": ""
        },
        {
          "type": "mule:error-handler",
          "name": "",
          "content": "%dw 2.0\noutput application/json\n---\n{message: \"Bad request\"}\n%dw 2.0\noutput application/json\n---\n{message: \"Resource not found\"}\n%dw 2.0\noutput application/json\n---\n{message: \"Method not allowed\"}"
        }
      ]
    },
    {
      "name": "hotel-api-console",
      "type": "flow",
      "trigger": "http-listener",
      "http_method": "",
      "http_path": "/console/*",
      "api_layer": "system",
      "step_count": 2,
      "source_project": "hotel-sys-api",
      "source_layer": "system",
      "connectors": [],
      "subflow_refs": [],
      "called_by": [],
      "call_count": 0,
      "sql_queries": [],
      "http_urls": [],
      "dataweave_complexity": "none",
      "is_boilerplate": true,
      "error_handlers": [],
      "dataweave_transforms": [],
      "set_variables": {},
      "processors": [
        {
          "type": "http:listener",
          "name": "",
          "content": ""
        },
        {
          "type": "apikit:console",
          "name": "",
          "content": ""
        }
      ]
    },
    {
      "name": "get:\\hotels\\search:hotel-api-config",
      "type": "flow",
      "trigger": "http-listener",
      "http_method": "GET",
      "http_path": "/hotels/search",
      "api_layer": "system",
      "step_count": 16,
      "source_project": "hotel-sys-api",
      "source_layer": "system",
      "connectors": [],
      "subflow_refs": [
        "validate-request",
        "database_select"
      ],
      "called_by": [],
      "call_count": 0,
      "sql_queries": [],
      "http_urls": [],
      "dataweave_complexity": "moderate",
      "is_boilerplate": false,
      "error_handlers": [
        {
          "type": "on-error-propagate",
          "error_type": "HTTP:BAD_REQUEST",
          "status_code": "400"
        },
        {
          "type": "on-error-propagate",
          "error_type": "ANY",
          "status_code": "500"
        }
      ],
      "dataweave_transforms": [
        {
          "content": "%dw 2.0\noutput application/json\n---\npayload map (hotel) -> {\n    hotelId: hotel.hotel_id,\n    name: hotel.name,\n    distanceMeters: hotel.distance_meters,\n    fromPrice: hotel.from_price,\n    currency: hotel.currency\n}",
          "output_fields": [
            "hotelId",
            "name",
            "distanceMeters",
            "fromPrice",
            "currency"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\npayload map (hotel) -> {\n    hotelId: hotel.hotel_id,\n    name: hotel.name,\n    distanceMeters: hotel.distance_meters,\n    fromPrice: hotel.from_price,\n    currency: hotel.currency\n}\n%dw 2.0\noutput application/json\n---\npayload map (hotel) -> {\n    hotelId: hotel.hotel_id,\n    name: hotel.name,\n    distanceMeters: hotel.distance_meters,\n    fromPrice: hotel.from_price,\n    currency: hotel.currency\n}",
          "output_fields": [
            "hotelId",
            "name",
            "distanceMeters",
            "fromPrice",
            "currency"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\npayload map (hotel) -> {\n    hotelId: hotel.hotel_id,\n    name: hotel.name,\n    distanceMeters: hotel.distance_meters,\n    fromPrice: hotel.from_price,\n    currency: hotel.currency\n}",
          "output_fields": [
            "hotelId",
            "name",
            "distanceMeters",
            "fromPrice",
            "currency"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{statusCode: 400, message: \"Bad request\"}",
          "output_fields": [
            "statusCode",
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{statusCode: 400, message: \"Bad request\"}\n%dw 2.0\noutput application/json\n---\n{statusCode: 400, message: \"Bad request\"}",
          "output_fields": [
            "statusCode",
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{statusCode: 400, message: \"Bad request\"}",
          "output_fields": [
            "statusCode",
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{statusCode: 500, message: \"Internal server error\"}",
          "output_fields": [
            "statusCode",
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{statusCode: 500, message: \"Internal server error\"}\n%dw 2.0\noutput application/json\n---\n{statusCode: 500, message: \"Internal server error\"}",
          "output_fields": [
            "statusCode",
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{statusCode: 500, message: \"Internal server error\"}",
          "output_fields": [
            "statusCode",
            "message"
          ]
        }
      ],
      "set_variables": {
        "searchQuery": "#[attributes.queryParams.q]"
      },
      "processors": [
        {
          "type": "http:listener",
          "name": "",
          "content": ""
        },
        {
          "type": "mule:set-variable",
          "name": "",
          "content": ""
        },
        {
          "type": "mule:flow-ref",
          "name": "validate-request",
          "content": ""
        },
        {
          "type": "mule:flow-ref",
          "name": "database_select",
          "content": ""
        },
        {
          "type": "ee:transform",
          "name": "Transform Response",
          "content": "%dw 2.0\noutput application/json\n---\npayload map (hotel) -> {\n    hotelId: hotel.hotel_id,\n    name: hotel.name,\n    distanceMeters: hotel.distance_meters,\n    fromPrice: hotel.from_price,\n    currency"
        },
        {
          "type": "mule:error-handler",
          "name": "",
          "content": "%dw 2.0\noutput application/json\n---\n{statusCode: 400, message: \"Bad request\"}\n%dw 2.0\noutput application/json\n---\n{statusCode: 500, message: \"Internal server error\"}"
        }
      ]
    },
    {
      "name": "get:\\hotels\\(id):hotel-api-config",
      "type": "flow",
      "trigger": "http-listener",
      "http_method": "GET",
      "http_path": "/hotels/(id)",
      "api_layer": "system",
      "step_count": 8,
      "source_project": "hotel-sys-api",
      "source_layer": "system",
      "connectors": [
        "db:select"
      ],
      "subflow_refs": [],
      "called_by": [],
      "call_count": 0,
      "sql_queries": [
        "SELECT hotel_id, name, description, address, city, distance_meters, from",
        "SELECT hotel_id, name, description, address, city, distance_meters, from"
      ],
      "http_urls": [],
      "dataweave_complexity": "complex",
      "is_boilerplate": false,
      "error_handlers": [],
      "dataweave_transforms": [
        {
          "content": "%dw 2.0\noutput application/json\n---\nif (sizeOf(payload) > 0)\n    {\n        hotelId: payload[0].hotel_id,\n        name: payload[0].name,\n        description: payload[0].description,\n        address: payload[0].address,\n        city: payload[0].city,\n        distanceMeters: payload[0].distance_meters,\n        fromPrice: payload[0].from_price,\n        currency: payload[0].currency,\n        rating: payload[0].rating,\n        amenities: payload[0].amenities\n    }\nelse\n    {statusCode: 404, message: \"",
          "output_fields": [
            "hotelId",
            "name",
            "description",
            "address",
            "city",
            "distanceMeters",
            "fromPrice",
            "currency",
            "rating",
            "amenities",
            "statusCode",
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\nif (sizeOf(payload) > 0)\n    {\n        hotelId: payload[0].hotel_id,\n        name: payload[0].name,\n        description: payload[0].description,\n        address: payload[0].address,\n        city: payload[0].city,\n        distanceMeters: payload[0].distance_meters,\n        fromPrice: payload[0].from_price,\n        currency: payload[0].currency,\n        rating: payload[0].rating,\n        amenities: payload[0].amenities\n    }\nelse\n    {statusCode: 404, message: \"",
          "output_fields": [
            "hotelId",
            "name",
            "description",
            "address",
            "city",
            "distanceMeters",
            "fromPrice",
            "currency",
            "rating",
            "amenities",
            "statusCode",
            "message"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\nif (sizeOf(payload) > 0)\n    {\n        hotelId: payload[0].hotel_id,\n        name: payload[0].name,\n        description: payload[0].description,\n        address: payload[0].address,\n        city: payload[0].city,\n        distanceMeters: payload[0].distance_meters,\n        fromPrice: payload[0].from_price,\n        currency: payload[0].currency,\n        rating: payload[0].rating,\n        amenities: payload[0].amenities\n    }\nelse\n    {statusCode: 404, message: \"",
          "output_fields": [
            "hotelId",
            "name",
            "description",
            "address",
            "city",
            "distanceMeters",
            "fromPrice",
            "currency",
            "rating",
            "amenities",
            "statusCode",
            "message"
          ]
        }
      ],
      "set_variables": {
        "hotelId": "#[attributes.uriParams.id]"
      },
      "processors": [
        {
          "type": "http:listener",
          "name": "",
          "content": ""
        },
        {
          "type": "mule:set-variable",
          "name": "",
          "content": ""
        },
        {
          "type": "db:select",
          "name": "",
          "content": "SELECT hotel_id, name, description, address, city, distance_meters, from_price, currency, rating, amenities FROM hotels WHERE hotel_id = :hotelId\nSELECT hotel_id, name, description, address, city, dis"
        },
        {
          "type": "ee:transform",
          "name": "Transform Hotel Detail",
          "content": "%dw 2.0\noutput application/json\n---\nif (sizeOf(payload) > 0)\n    {\n        hotelId: payload[0].hotel_id,\n        name: payload[0].name,\n        description: payload[0].description,\n        address: pa"
        }
      ]
    },
    {
      "name": "post:\\hotels\\(id)\\book:hotel-api-config",
      "type": "flow",
      "trigger": "http-listener",
      "http_method": "POST",
      "http_path": "/hotels/(id)/book",
      "api_layer": "system",
      "step_count": 13,
      "source_project": "hotel-sys-api",
      "source_layer": "system",
      "connectors": [
        "db:insert"
      ],
      "subflow_refs": [
        "validate-request",
        "send-booking-notification"
      ],
      "called_by": [],
      "call_count": 0,
      "sql_queries": [
        "INSERT INTO bookings (hotel_id, guest_name, check_in, check_out, status, created_at) VALUES",
        "INSERT INTO bookings (hotel_id, guest_name, check_in, check_out, status, created_at) VALUES"
      ],
      "http_urls": [],
      "dataweave_complexity": "moderate",
      "is_boilerplate": false,
      "error_handlers": [],
      "dataweave_transforms": [
        {
          "content": "%dw 2.0\noutput application/json\n---\n{\n    bookingId: uuid(),\n    hotelId: vars.hotelId,\n    guestName: vars.guestName,\n    checkIn: vars.checkIn,\n    checkOut: vars.checkOut,\n    status: \"CONFIRMED\"\n}",
          "output_fields": [
            "bookingId",
            "hotelId",
            "guestName",
            "checkIn",
            "checkOut",
            "status"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{\n    bookingId: uuid(),\n    hotelId: vars.hotelId,\n    guestName: vars.guestName,\n    checkIn: vars.checkIn,\n    checkOut: vars.checkOut,\n    status: \"CONFIRMED\"\n}\n%dw 2.0\noutput application/json\n---\n{\n    bookingId: uuid(),\n    hotelId: vars.hotelId,\n    guestName: vars.guestName,\n    checkIn: vars.checkIn,\n    checkOut: vars.checkOut,\n    status: \"CONFIRMED\"\n}",
          "output_fields": [
            "bookingId",
            "hotelId",
            "guestName",
            "checkIn",
            "checkOut",
            "status"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{\n    bookingId: uuid(),\n    hotelId: vars.hotelId,\n    guestName: vars.guestName,\n    checkIn: vars.checkIn,\n    checkOut: vars.checkOut,\n    status: \"CONFIRMED\"\n}",
          "output_fields": [
            "bookingId",
            "hotelId",
            "guestName",
            "checkIn",
            "checkOut",
            "status"
          ]
        }
      ],
      "set_variables": {
        "hotelId": "#[attributes.uriParams.id]",
        "guestName": "#[payload.guestName]",
        "checkIn": "#[payload.checkInDate]",
        "checkOut": "#[payload.checkOutDate]"
      },
      "processors": [
        {
          "type": "http:listener",
          "name": "",
          "content": ""
        },
        {
          "type": "mule:set-variable",
          "name": "",
          "content": ""
        },
        {
          "type": "mule:set-variable",
          "name": "",
          "content": ""
        },
        {
          "type": "mule:set-variable",
          "name": "",
          "content": ""
        },
        {
          "type": "mule:set-variable",
          "name": "",
          "content": ""
        },
        {
          "type": "mule:flow-ref",
          "name": "validate-request",
          "content": ""
        },
        {
          "type": "db:insert",
          "name": "",
          "content": "INSERT INTO bookings (hotel_id, guest_name, check_in, check_out, status, created_at) VALUES (:hotelId, :guestName, :checkIn, :checkOut, 'CONFIRMED', GETDATE())\nINSERT INTO bookings (hotel_id, guest_na"
        },
        {
          "type": "ee:transform",
          "name": "Booking Confirmation Response",
          "content": "%dw 2.0\noutput application/json\n---\n{\n    bookingId: uuid(),\n    hotelId: vars.hotelId,\n    guestName: vars.guestName,\n    checkIn: vars.checkIn,\n    checkOut: vars.checkOut,\n    status: \"CONFIRMED\"\n}"
        },
        {
          "type": "mule:flow-ref",
          "name": "send-booking-notification",
          "content": ""
        }
      ]
    },
    {
      "name": "get:\\health:hotel-api-config",
      "type": "flow",
      "trigger": "http-listener",
      "http_method": "GET",
      "http_path": "/health",
      "api_layer": "system",
      "step_count": 4,
      "source_project": "hotel-sys-api",
      "source_layer": "system",
      "connectors": [],
      "subflow_refs": [],
      "called_by": [],
      "call_count": 0,
      "sql_queries": [],
      "http_urls": [],
      "dataweave_complexity": "simple",
      "is_boilerplate": false,
      "error_handlers": [],
      "dataweave_transforms": [
        {
          "content": "%dw 2.0\noutput application/json\n---\n{status: \"UP\"}",
          "output_fields": [
            "status"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{status: \"UP\"}\n%dw 2.0\noutput application/json\n---\n{status: \"UP\"}",
          "output_fields": [
            "status"
          ]
        },
        {
          "content": "%dw 2.0\noutput application/json\n---\n{status: \"UP\"}",
          "output_fields": [
            "status"
          ]
        }
      ],
      "set_variables": {},
      "processors": [
        {
          "type": "http:listener",
          "name": "",
          "content": ""
        },
        {
          "type": "ee:transform",
          "name": "",
          "content": "%dw 2.0\noutput application/json\n---\n{status: \"UP\"}"
        }
      ]
    },
    {
      "name": "validate-request",
      "type": "sub-flow",
      "trigger": "none",
      "http_method": "",
      "http_path": "",
      "api_layer": "system",
      "step_count": 3,
      "source_project": "hotel-sys-api",
      "source_layer": "system",
      "connectors": [],
      "subflow_refs": [],
      "called_by": [
        "get:\\hotels\\search:hotel-api-config",
        "post:\\hotels\\(id)\\book:hotel-api-config"
      ],
      "call_count": 2,
      "sql_queries": [],
      "http_urls": [],
      "dataweave_complexity": "none",
      "is_boilerplate": false,
      "error_handlers": [],
      "dataweave_transforms": [],
      "set_variables": {},
      "processors": [
        {
          "type": "mule:choice",
          "name": "",
          "content": ""
        }
      ]
    },
    {
      "name": "database_select",
      "type": "sub-flow",
      "trigger": "none",
      "http_method": "",
      "http_path": "",
      "api_layer": "system",
      "step_count": 3,
      "source_project": "hotel-sys-api",
      "source_layer": "system",
      "connectors": [
        "db:select"
      ],
      "subflow_refs": [],
      "called_by": [
        "get:\\hotels\\search:hotel-api-config"
      ],
      "call_count": 1,
      "sql_queries": [
        "SELECT hotel_id, name, distance_meters, from",
        "SELECT hotel_id, name, distance_meters, from"
      ],
      "http_urls": [],
      "dataweave_complexity": "none",
      "is_boilerplate": false,
      "error_handlers": [],
      "dataweave_transforms": [],
      "set_variables": {},
      "processors": [
        {
          "type": "db:select",
          "name": "",
          "content": "SELECT hotel_id, name, distance_meters, from_price, currency FROM hotels WHERE city LIKE :query OR name LIKE :query ORDER BY from_price ASC\nSELECT hotel_id, name, distance_meters, from_price, currency"
        }
      ]
    },
    {
      "name": "send-booking-notification",
      "type": "sub-flow",
      "trigger": "none",
      "http_method": "",
      "http_path": "",
      "api_layer": "system",
      "step_count": 3,
      "source_project": "hotel-sys-api",
      "source_layer": "system",
      "connectors": [
        "http:request"
      ],
      "subflow_refs": [],
      "called_by": [
        "post:\\hotels\\(id)\\book:hotel-api-config"
      ],
      "call_count": 1,
      "sql_queries": [],
      "http_urls": [],
      "dataweave_complexity": "none",
      "is_boilerplate": false,
      "error_handlers": [],
      "dataweave_transforms": [],
      "set_variables": {},
      "processors": [
        {
          "type": "mule:logger",
          "name": "",
          "content": ""
        },
        {
          "type": "http:request",
          "name": "",
          "content": "#[{\n                to: vars.guestEmail default \"guest@example.com\",\n                subject: \"Booking Confirmed\",\n                body: \"Your booking at hotel \" ++ vars.hotelId ++ \" is confirmed.\"\n  "
        }
      ]
    }
  ],
  "connectors": [
    {
      "name": "hotel-api-httpListenerConfig",
      "type": "http:listener-config",
      "connection_type": "http",
      "details": {
        "name": "hotel-api-httpListenerConfig",
        "listener-connection.host": "0.0.0.0",
        "listener-connection.port": "8081"
      }
    },
    {
      "name": "hotel-db-config",
      "type": "db:config",
      "connection_type": "mssql",
      "details": {
        "name": "hotel-db-config",
        "mssql-connection.host": "${db.host}",
        "mssql-connection.port": "1433",
        "mssql-connection.user": "${db.user}",
        "mssql-connection.password": "${secure::db.password}",
        "mssql-connection.database": "hotels"
      }
    },
    {
      "name": "hotel-api-config",
      "type": "apikit:config",
      "connection_type": "generic",
      "details": {
        "name": "hotel-api-config",
        "api": "api/hotel-api.raml",
        "raml": "api/hotel-api.raml"
      }
    }
  ],
  "raml_endpoints": [
    {
      "path": "/hotels/search",
      "method": "GET",
      "display_name": "Search Hotels",
      "query_params": [
        {
          "name": "q",
          "type": "string"
        },
        {
          "name": "maxResults",
          "type": "string"
        }
      ]
    },
    {
      "path": "/hotels/{id}",
      "method": "GET",
      "display_name": "Get Hotel Details",
      "query_params": []
    },
    {
      "path": "/hotels/{id}/book",
      "method": "POST",
      "display_name": "Book Hotel",
      "query_params": []
    }
  ],
  "config_properties": [
    {
      "key": "db.host",
      "value": "hotel-db.example.com"
    },
    {
      "key": "db.port",
      "value": "1433"
    },
    {
      "key": "db.user",
      "value": "hotel_api_user"
    },
    {
      "key": "db.password",
      "value": "***"
    },
    {
      "key": "db.database",
      "value": "hotels"
    },
    {
      "key": "http.port",
      "value": "8081"
    },
    {
      "key": "api.version",
      "value": "v1"
    },
    {
      "key": "notification.service.host",
      "value": "notifications.internal.example.com"
    },
    {
      "key": "notification.service.port",
      "value": "8443"
    },
    {
      "key": "notification.email.from",
      "value": "noreply@example.com"
    }
  ]
}
